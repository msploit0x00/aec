{
 "add_total_row": 0,
 "columns": [],
 "creation": "2024-10-22 16:50:29.074883",
 "disable_prepared_report": 0,
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 0,
 "is_standard": "Yes",
 "javascript": "frappe.query_reports['Export Opportunites Generalization']= {\n    \"filters\": [\n           {\n            \"fieldname\": \"member\",\n            \"label\": __(\"Customer\"),\n            \"fieldtype\": \"Link\",\n            \"options\": \"Customer\",\n            \"width\": \"200px\"\n        },\n   \n        {   \n            \"fieldname\": \"committee_name\",\n            \"label\": __(\"Please insert Committee\"),\n            \"fieldtype\": \"Link\",\n            options: \"Committee\",\n            \"width\": \"350px\"\n          \n        },\n        {\n            \"fieldname\": \"territory_code\",\n            \"label\": __(\"Please Select Governorate\"),\n            \"fieldtype\": \"Link\",\n            \"options\": \"Territory\",\n            \"width\": \"350px\"\n        },    \n     \n     {\n            fieldname: \"custom_customer_status\",\n            label: \"Please select Membership Status\",\n            fieldtype: 'Select',\n            options: [\n                '',\n                'Requested',\n                'Requested From Website',\n                'Active',\n                'Inactive',\n                'Suspended',\n                '\u0627\u0633\u062a\u064a\u0641\u0627\u0621 \u0628\u064a\u0627\u0646\u0627\u062a'\n            ],\n            default: ''\n           \n        },\n     {\n             \"fieldname\": \"name_of_the_cioowner_of_the_company\",\n             \"label\": __(\"Please write CIO arabic\"),\n             \"fieldtype\": \"Data\",\n             \"width\": \"200px\"\n        },    \n\n        // You can add more filters here as per your requirement\n    ],\n    get_datatable_options(options) {\n\t\treturn Object.assign(options, {\n\t\t\tcheckboxColumn: true,\n\t\t});\n\t},\nonload: function(report) {\n    report.page.add_inner_button(__(\"Get Selected\"), function() {\n        var values = report.get_values();\n        var member = values.member;\n        var committee_name = values.committee_name;\n        var territory = values.territory;\n        var custom_customer_status = values.custom_customer_status;\n        var name_of_the_cioowner_of_the_company = values.name_of_the_cioowner_of_the_company;\n        var selected_rows = [];\n        $('.dt-scrollable').find(\":input[type=checkbox]\").each((idx, checkbox) => {\n            if (checkbox.checked) {\n                var rowData = $(checkbox).closest('.dt-row').find('.dt-cell__content').map(function() {\n                    return $(this).text().trim();\n                }).get();\n                var member_code = rowData[2];\n                var ceo_name = rowData[3];\n                var committees = rowData[4];\n                var export_value_in_egp = rowData[5];\n                var export_value_in_usd = rowData[6];\n                var export_volume = rowData[7];\n                var governorate = rowData[8];\n                var customer_status = rowData[9];\n                var ceo_mobile = rowData[10];\n                var email = rowData[12];\n               console.log(\"EMAI\",export_volume);\n                ///////////////////////\n                    selected_rows.push({\n                    member_code:member_code,\n                    ceo_name:ceo_name,\n                    committees:committees,\n                    export_value_in_egp:export_value_in_egp,\n                    export_value_in_usd:export_value_in_usd,\n                    export_volume:export_volume,\n                    governorate:governorate,\n                    customer_status:customer_status,\n                    ceo_mobile:ceo_mobile,\n                    email:email\n                    });\n                //////////////////////////    \n                }\n            });\n        // for (let row of selected_rows) {       \n        frappe.call({\n            method: 'frappe.client.insert',\n            args: {\n                doc: {\n                doctype: 'Foreigner  Affairs  Opportunities',\n                \"member_code\":member,\n\n                \"ceo_name\":name_of_the_cioowner_of_the_company,\n                \"committee\":committee_name,\n                \"governorate\" : territory,\n                \"customer_status\" :custom_customer_status,\n        \tmember_info: selected_rows\n            },\n            },\n            callback: function(r) {\n                         console.log(r.message);\n                        console.log(r.message.name);\n                        frappe.set_route(\"Form\",\"Foreigner  Affairs  Opportunities\",r.message.name);\n        \t\t}\n        });\n               \n//}\n/////////////\n                                    \n    });\n},\n\n\n\n\n\n\n\n}\n",
 "json": "{\"filters\":[],\"fields\":[[\"custom_email\",\"Customer\"],[\"custom_name_of_the_cioowner_of_the_company\",\"Customer\"],[\"customer_name\",\"Customer\"],[\"custom_company_code\",\"Customer\"],[\"name\",\"Customer\"],[\"customer_group\",\"Customer\"],[\"docstatus\",\"Customer\"],[\"custom_customer_status\",\"Customer\"],[\"custom_reason_for_susbending\",\"Customer\"],[\"custom_registration_number_in_commercial_register\",\"Customer\"],[\"tax_id\",\"Customer\"],[\"custom_board_of_directors_member_\",\"Customer\"],[\"customer_primary_contact\",\"Customer\"],[\"disabled\",\"Customer\"]],\"order_by\":\"`tabCustomer`.`modified` asc\",\"add_totals_row\":0,\"page_length\":20,\"column_widths\":{\"custom_email\":120,\"custom_name_of_the_cioowner_of_the_company\":120,\"customer_name\":120,\"custom_company_code\":120,\"name\":120,\"customer_group\":120,\"docstatus\":120,\"custom_customer_status\":120,\"custom_reason_for_susbending\":120,\"custom_registration_number_in_commercial_register\":120,\"tax_id\":120,\"custom_board_of_directors_member_\":120,\"customer_primary_contact\":120,\"disabled\":120},\"group_by\":null}",
 "letter_head": "header",
 "modified": "2024-10-22 16:50:29.074883",
 "modified_by": "Administrator",
 "module": "Aec",
 "name": "Export Opportunites Generalization2",
 "owner": "Administrator",
 "prepared_report": 0,
 "query": "",
 "ref_doctype": "Customer",
 "report_name": "Export Opportunites Generalization2",
 "report_script": "columns = [\n  \n    {\"label\": _(\"Member code\"), \"fieldname\": \"member\", \"fieldtype\": \"Link\", \"options\": \"Customer\", \"width\": 150},\n    {\"label\": _(\"CIO Name\"), \"fieldname\": \"custom_name_of_the_cioowner_of_the_company\", \"fieldtype\": \"Data\", \"width\": 200},\n    {\"label\": _(\"Committee Name\"), \"fieldname\": \"committee_name\", \"fieldtype\": \"Link\", \"options\": \"Committee\", \"width\": 200},\n    {\"label\": _(\"Total Amount in EGP\"), \"fieldname\": \"total_amount_in_egp\", \"fieldtype\": \"Currency\", \"width\": 150},\n    {\"label\": _(\"Total Amount in USD\"), \"fieldname\": \"total_amount_in_usd\", \"fieldtype\": \"Data\", \"width\": 150},\n    {\"label\": _(\"current season\"), \"fieldname\": \"current_season\", \"fieldtype\": \"data\", \"width\": 150},\n    {\"label\": _(\"Governorate code\"), \"fieldname\": \"territory_code\", \"fieldtype\": \"Data\", \"width\": 150},\n    {\"label\": _(\"Governorate\"), \"fieldname\": \"territory\", \"fieldtype\": \"Data\", \"width\": 150},\n    {\"label\": _(\"Membership status\"), \"fieldname\": \"custom_customer_status\", \"fieldtype\": \"Data\", \"width\": 150},\n    {\"label\": _(\"CEO Mobile\"), \"fieldname\": \"customer_primary_contact\", \"fieldtype\": \"Data\", \"width\": 200},\n    {\"label\": _(\"Email\"), \"fieldname\": \"email\", \"fieldtype\": \"Email\", \"width\": 150},\n\n]\n\n\n\n# Get values from filters or set them to None\n\nmember = filters.get(\"member\")\nname_of_the_cioowner_of_the_company = filters.get(\"name_of_the_cioowner_of_the_company\")\ncommittee_name = filters.get(\"committee_name\")\nterritory_code = filters.get(\"territory_code\")\ncustom_customer_status = filters.get(\"custom_customer_status\")\n\n\n\n#def show_report(filters=None):\nsql = \"\"\"\n    SELECT\n    `tabCustomer`.`name` AS `member`,\n    `tabCustomer`.`custom_name_of_the_cioowner_of_the_company` AS `custom_name_of_the_cioowner_of_the_company`,\n     GROUP_CONCAT( DISTINCT  `tabCommittees you would like to join`.`committees` SEPARATOR ', ') AS `committee_name`,\n    `tabVolume Of Member Exports for Three Years`.`total_amount_in_egp` AS `total_amount_in_egp`,\n    CONCAT(FLOOR(`tabVolume Of Member Exports for Three Years`.`total_amount_in_usd`), ' $') AS `total_amount_in_usd`,\n     CONCAT(YEAR(CURDATE()) - 2 , '-', YEAR(CURDATE())-1)AS current_season,\n    `tabCustomer`.`territory` AS `territory_code`,\n    `tabCustomer`.`governorate_name` AS `territory`,\n    `tabCustomer`.`custom_ceo_mobile` AS `customer_primary_contact`,\n    `tabCustomer`.`custom_customer_status` AS `custom_customer_status`,\n    `tabCustomer`.`custom_email` AS `email`\nFROM\n    `tabCustomer`\nLEFT JOIN `tabCommittees you would like to join`\n    ON `tabCommittees you would like to join`.`parent` = `tabCustomer`.`name`\nLEFT JOIN `tabVolume Of Member Exports for Three Years`\n    ON `tabVolume Of Member Exports for Three Years`.`parent` = `tabCustomer`.`name`\n\n\n\"\"\"\nif not (committee_name): \n    mysql =sql+ \"\"\"\n            WHERE\n                (%(member)s IS NULL OR `tabCustomer`.`name` = %(member)s)\n                AND (%(name_of_the_cioowner_of_the_company)s IS NULL OR `tabCustomer`.`custom_name_of_the_cioowner_of_the_company` LIKE %(name_of_the_cioowner_of_the_company)s)\n                AND (%(territory_code)s IS NULL OR `tabCustomer`.`territory` LIKE %(territory_code)s)\n                AND (%(custom_customer_status)s IS NULL OR `tabCustomer`.`custom_customer_status` LIKE %(custom_customer_status)s)\n                AND (`tabVolume Of Member Exports for Three Years`.`season_name` = CONCAT(YEAR(CURDATE()) - 2 , '-', YEAR(CURDATE())-1))  \n                GROUP BY `tabCustomer`.`name` ASC\n            \"\"\"\n       \n    mydata = frappe.db.sql(\n        mysql,\n        {\n            \"member\":f\"%{member}%\" if member else None,\n            \"name_of_the_cioowner_of_the_company\": f\"%{name_of_the_cioowner_of_the_company}%\" if name_of_the_cioowner_of_the_company else None,\n            \"territory_code\": f\"%{territory_code}%\" if territory_code else None,\n            \"custom_customer_status\": f\"%{custom_customer_status}%\" if custom_customer_status else None,\n        },\n        as_dict=True,\n    )\nif (committee_name): \n    mysql =sql+ \"\"\"\n            WHERE\n                (%(member)s IS NULL OR `tabCustomer`.`name` = %(member)s)\n                AND (%(name_of_the_cioowner_of_the_company)s IS NULL OR `tabCustomer`.`custom_name_of_the_cioowner_of_the_company` LIKE %(name_of_the_cioowner_of_the_company)s)\n                AND (%(territory_code)s IS NULL OR `tabCustomer`.`territory` LIKE %(territory_code)s)\n                AND (%(custom_customer_status)s IS NULL OR `tabCustomer`.`custom_customer_status` LIKE %(custom_customer_status)s)\n                AND (`tabVolume Of Member Exports for Three Years`.`season_name` = CONCAT(YEAR(CURDATE()) - 2 , '-', YEAR(CURDATE())-1))  \n            GROUP BY `tabCustomer`.`name` ASC\n            HAVING GROUP_CONCAT(`tabCommittees you would like to join`.`committees` SEPARATOR ', ') LIKE %(committee_name)s\n            \"\"\"\n       \n    mydata = frappe.db.sql(\n        mysql,\n        {   \n            \"committee_name\": f\"%{committee_name}%\" if committee_name else None,\n            \"member\":f\"%{member}%\" if member else None,\n            \"name_of_the_cioowner_of_the_company\": f\"%{name_of_the_cioowner_of_the_company}%\" if name_of_the_cioowner_of_the_company else None,\n            \"territory_code\": f\"%{territory_code}%\" if territory_code else None,\n            \"custom_customer_status\": f\"%{custom_customer_status}%\" if custom_customer_status else None,\n        },\n        as_dict=True,\n    )\n\n\ndata = columns ,mydata\n\n\n",
 "report_type": "Script Report",
 "roles": [
  {
   "role": "Sales Master Manager"
  },
  {
   "role": "Stock User"
  },
  {
   "role": "Accounts Manager"
  },
  {
   "role": "Accounts User"
  },
  {
   "role": "Sales Manager"
  },
  {
   "role": "Sales User"
  },
  {
   "role": "Stock Manager"
  },
  {
   "role": "Member Show"
  }
 ]
}